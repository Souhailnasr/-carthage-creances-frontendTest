<div class="notification-container">
  <button class="notification-button" (click)="toggleDropdown()">
    <i class="fas fa-bell"></i>
    <span class="notification-badge" *ngIf="countNonLues > 0">{{ countNonLues }}</span>
  </button>

  <div class="notification-dropdown" *ngIf="showDropdown">
    <div class="notification-header">
      <h3><i class="fas fa-bell"></i> Notifications</h3>
      <div class="header-actions">
        <button class="btn btn-sm btn-success" (click)="showCreateNotification = true">
          <i class="fas fa-plus"></i> Nouvelle
        </button>
        <button class="btn btn-sm btn-primary" (click)="marquerToutesLues()" *ngIf="countNonLues > 0">
          <i class="fas fa-check"></i> Marquer toutes lues
        </button>
      </div>
    </div>

    <!-- Formulaire de création de notification -->
    <div class="create-notification-form" *ngIf="showCreateNotification">
      <h4><i class="fas fa-plus-circle"></i> Créer une notification</h4>
      <form (ngSubmit)="createNotification()" #notificationForm="ngForm">
        <div class="form-group">
          <label>Titre :</label>
          <input type="text" [(ngModel)]="newNotification.titre" name="titre" required class="form-control">
        </div>
        <div class="form-group">
          <label>Message :</label>
          <textarea [(ngModel)]="newNotification.message" name="message" required class="form-control" rows="3"></textarea>
        </div>
        <div class="form-group">
          <label>Type :</label>
          <select [(ngModel)]="newNotification.type" name="type" required class="form-control">
            <option value="DOSSIER_CREE">Dossier Créé</option>
            <option value="DOSSIER_VALIDE">Dossier Validé</option>
            <option value="DOSSIER_REJETE">Dossier Rejeté</option>
            <option value="ENQUETE_CREE">Enquête Créée</option>
            <option value="ENQUETE_VALIDE">Enquête Validée</option>
            <option value="TACHE_URGENTE">Tâche Urgente</option>
            <option value="RAPPEL">Rappel</option>
          </select>
        </div>
        <div class="form-actions">
          <button type="submit" class="btn btn-primary" [disabled]="notificationForm.invalid">
            <i class="fas fa-save"></i> Créer
          </button>
          <button type="button" class="btn btn-secondary" (click)="cancelCreateNotification()">
            <i class="fas fa-times"></i> Annuler
          </button>
        </div>
      </form>
    </div>

    <div class="notification-list">
      <div class="notification-item" 
           *ngFor="let notification of notifications" 
           [ngClass]="getNotificationClass(notification.type)"
           (click)="marquerLue(notification)">
        
        <div class="notification-icon">
          <i [class]="getNotificationIcon(notification.type)"></i>
        </div>
        
        <div class="notification-content">
          <h4>{{ notification.titre }}</h4>
          <p>{{ notification.message }}</p>
          <small>{{ notification.dateCreation | date:'dd/MM/yyyy HH:mm' }}</small>
        </div>
        
        <div class="notification-status" *ngIf="notification.statut === 'NON_LUE'">
          <span class="status-dot"></span>
        </div>
      </div>

      <div class="no-notifications" *ngIf="notifications.length === 0">
        <i class="fas fa-bell-slash"></i>
        <p>Aucune notification</p>
        <button class="btn btn-primary btn-sm" (click)="showCreateNotification = true">
          <i class="fas fa-plus"></i> Créer la première notification
        </button>
      </div>
    </div>
  </div>
</div>
