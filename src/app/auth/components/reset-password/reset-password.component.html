<div class="reset-password-container">
  <div class="reset-password-card">
    <!-- Logo et titre -->
    <div class="reset-password-header">
      <div class="logo">
        <i class="fas fa-balance-scale"></i>
        <h1>Carthage Créance</h1>
      </div>
      <p class="subtitle">Réinitialisation de mot de passe</p>
    </div>

    <!-- Validation du token en cours -->
    <div class="loading-container" *ngIf="isValidatingToken">
      <mat-spinner diameter="50"></mat-spinner>
      <p>Validation du lien de réinitialisation...</p>
    </div>

    <!-- Token invalide -->
    <div class="error-container" *ngIf="!isValidatingToken && !isValidToken">
      <div class="error-icon">
        <i class="fas fa-exclamation-triangle"></i>
      </div>
      <h2>Lien invalide ou expiré</h2>
      <p>Le lien de réinitialisation est invalide ou a expiré.</p>
      <p class="info-text">Vous pouvez demander un nouveau lien de réinitialisation.</p>
      <div class="error-actions">
        <button mat-raised-button color="primary" (click)="resendEmail()" [disabled]="isLoading">
          <i class="fas fa-envelope"></i>
          Renvoyer un email de réinitialisation
        </button>
        <button mat-button (click)="goToLogin()">
          <i class="fas fa-arrow-left"></i>
          Retour à la connexion
        </button>
      </div>
    </div>

    <!-- Message de succès -->
    <div class="success-message" *ngIf="passwordReset">
      <div class="success-icon">
        <i class="fas fa-check-circle"></i>
      </div>
      <h2>Mot de passe réinitialisé</h2>
      <p>Votre mot de passe a été réinitialisé avec succès.</p>
      <p class="info-text">Vous allez être redirigé vers la page de connexion...</p>
        <button mat-raised-button color="primary" (click)="goToLogin()" class="btn-login">
          <i class="fas fa-sign-in-alt"></i>
          Se connecter maintenant
        </button>
    </div>

    <!-- Formulaire de réinitialisation -->
    <form *ngIf="!isValidatingToken && isValidToken && !passwordReset" 
          class="reset-password-form" 
          [formGroup]="resetPasswordForm" 
          (ngSubmit)="onSubmit()">
      
      <p class="instruction-text">
        Veuillez entrer votre nouveau mot de passe. Assurez-vous qu'il respecte tous les critères de sécurité.
      </p>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Nouveau mot de passe</mat-label>
        <input
          matInput
          [type]="showPassword ? 'text' : 'password'"
          formControlName="newPassword"
          placeholder="Entrez votre nouveau mot de passe"
          autocomplete="new-password">
        <mat-icon matPrefix>lock</mat-icon>
        <button
          mat-icon-button
          matSuffix
          type="button"
          (click)="togglePasswordVisibility()"
          [attr.aria-label]="showPassword ? 'Masquer le mot de passe' : 'Afficher le mot de passe'">
          <mat-icon>{{ showPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
        <mat-error *ngIf="newPassword?.invalid && (newPassword?.dirty || newPassword?.touched)">
          <span *ngIf="newPassword?.errors?.['required']">Le mot de passe est requis</span>
          <span *ngIf="newPassword?.errors?.['weakPassword']">Le mot de passe ne respecte pas les critères de sécurité</span>
        </mat-error>
      </mat-form-field>

      <!-- Indicateur de force du mot de passe -->
      <app-password-strength *ngIf="newPassword?.value" [password]="newPassword?.value || ''"></app-password-strength>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Confirmer le nouveau mot de passe</mat-label>
        <input
          matInput
          [type]="showConfirmPassword ? 'text' : 'password'"
          formControlName="confirmPassword"
          placeholder="Confirmez votre nouveau mot de passe"
          autocomplete="new-password">
        <mat-icon matPrefix>lock_outline</mat-icon>
        <button
          mat-icon-button
          matSuffix
          type="button"
          (click)="toggleConfirmPasswordVisibility()"
          [attr.aria-label]="showConfirmPassword ? 'Masquer le mot de passe' : 'Afficher le mot de passe'">
          <mat-icon>{{ showConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
        <mat-error *ngIf="confirmPassword?.invalid && (confirmPassword?.dirty || confirmPassword?.touched)">
          <span *ngIf="confirmPassword?.errors?.['required']">La confirmation du mot de passe est requise</span>
        </mat-error>
        <mat-error *ngIf="resetPasswordForm.errors?.['passwordMismatch'] && (confirmPassword?.dirty || confirmPassword?.touched)">
          Les mots de passe ne correspondent pas
        </mat-error>
      </mat-form-field>

      <div class="form-actions">
        <button
          mat-raised-button
          color="primary"
          type="submit"
          [disabled]="isLoading || resetPasswordForm.invalid"
          class="btn-submit">
          <mat-spinner diameter="20" *ngIf="isLoading" class="spinner-inline"></mat-spinner>
          <i class="fas fa-key" *ngIf="!isLoading"></i>
          <span>{{ isLoading ? 'Réinitialisation...' : 'Réinitialiser le mot de passe' }}</span>
        </button>

        <button
          mat-button
          type="button"
          (click)="goToLogin()"
          [disabled]="isLoading"
          class="btn-back-link">
          <i class="fas fa-arrow-left"></i>
          Retour à la connexion
        </button>
      </div>
    </form>
  </div>
</div>

