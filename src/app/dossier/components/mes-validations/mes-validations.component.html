<div class="mes-validations-container">
  <div class="header">
    <h1><mat-icon>history</mat-icon> Mes Validations</h1>
    <p class="subtitle">Dossiers validés par moi pour mes agents</p>
  </div>

  <!-- Statistiques -->
  <div class="stats-section">
    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-value">{{ stats.total }}</div>
        <div class="stat-label">Total</div>
      </mat-card-content>
    </mat-card>
    <mat-card class="stat-card stat-en-attente">
      <mat-card-content>
        <div class="stat-value">{{ stats.enAttente }}</div>
        <div class="stat-label">En Attente</div>
      </mat-card-content>
    </mat-card>
    <mat-card class="stat-card stat-valide">
      <mat-card-content>
        <div class="stat-value">{{ stats.valides }}</div>
        <div class="stat-label">Validés</div>
      </mat-card-content>
    </mat-card>
    <mat-card class="stat-card stat-rejete">
      <mat-card-content>
        <div class="stat-value">{{ stats.rejetes }}</div>
        <div class="stat-label">Rejetés</div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Filtres -->
  <div class="filters-section">
    <mat-form-field appearance="outline" class="filter-field">
      <mat-label>Statut</mat-label>
      <mat-select [formControl]="statutFilter">
        <mat-option value="TOUS">Tous</mat-option>
        <mat-option value="EN_ATTENTE">En Attente</mat-option>
        <mat-option value="VALIDE">Validé</mat-option>
        <mat-option value="REJETE">Rejeté</mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline" class="search-field">
      <mat-label>Rechercher</mat-label>
      <input matInput 
             [formControl]="searchControl"
             placeholder="Numéro dossier ou titre...">
      <mat-icon matSuffix>search</mat-icon>
      <button mat-icon-button 
              matSuffix 
              *ngIf="searchControl.value"
              (click)="clearSearch()"
              title="Effacer">
        <mat-icon>clear</mat-icon>
      </button>
    </mat-form-field>
  </div>

  <!-- Loading -->
  <div class="loading-container" *ngIf="loading">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Chargement en cours...</p>
  </div>

  <!-- Table -->
  <div class="table-container" *ngIf="!loading">
    <table mat-table [dataSource]="filteredDataSource" class="validations-table">
      <!-- Numéro Dossier Column -->
      <ng-container matColumnDef="numeroDossier">
        <th mat-header-cell *matHeaderCellDef>Numéro Dossier</th>
        <td mat-cell *matCellDef="let validation">{{ validation.dossier.numeroDossier }}</td>
      </ng-container>

      <!-- Titre Column -->
      <ng-container matColumnDef="titre">
        <th mat-header-cell *matHeaderCellDef>Titre</th>
        <td mat-cell *matCellDef="let validation">{{ validation.dossier.titre }}</td>
      </ng-container>

      <!-- Statut Column -->
      <ng-container matColumnDef="statut">
        <th mat-header-cell *matHeaderCellDef>Statut</th>
        <td mat-cell *matCellDef="let validation">
          <span class="statut-badge" [ngClass]="getStatutClass(validation.statut)">
            {{ getStatutLabel(validation.statut) }}
          </span>
        </td>
      </ng-container>

      <!-- Date Création Column -->
      <ng-container matColumnDef="dateCreation">
        <th mat-header-cell *matHeaderCellDef>Date Création</th>
        <td mat-cell *matCellDef="let validation">{{ formatDate(validation.dateCreation) }}</td>
      </ng-container>

      <!-- Date Validation Column -->
      <ng-container matColumnDef="dateValidation">
        <th mat-header-cell *matHeaderCellDef>Date Validation</th>
        <td mat-cell *matCellDef="let validation">{{ formatDate(validation.dateValidation) }}</td>
      </ng-container>

      <!-- Chef Validateur Column -->
      <ng-container matColumnDef="chefValidateur">
        <th mat-header-cell *matHeaderCellDef>Chef Validateur</th>
        <td mat-cell *matCellDef="let validation">{{ getChefName(validation) }}</td>
      </ng-container>

      <!-- Commentaires Column -->
      <ng-container matColumnDef="commentaires">
        <th mat-header-cell *matHeaderCellDef>Commentaires</th>
        <td mat-cell *matCellDef="let validation">
          <span class="commentaire" *ngIf="validation.commentaires; else noComment">
            {{ validation.commentaires }}
          </span>
          <ng-template #noComment>-</ng-template>
        </td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let validation" class="actions-cell">
          <button mat-icon-button 
                  color="primary" 
                  (click)="voirDetails(validation)"
                  title="Voir détails">
            <mat-icon>visibility</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

      <!-- No data row -->
      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell" [attr.colspan]="displayedColumns.length">
          <div class="no-data">
            <mat-icon>info</mat-icon>
            <p>Aucune validation trouvée</p>
          </div>
        </td>
      </tr>
    </table>

    <mat-paginator [pageSizeOptions]="[5, 10, 20, 50]" 
                   [pageSize]="10"
                   showFirstLastButtons>
    </mat-paginator>
  </div>
</div>

